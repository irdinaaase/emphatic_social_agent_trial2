<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Hub - Empathic Learning Agent</title>
    
    <!-- Global CSS -->
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/accessibility.css">
    
    <!-- Shared Components CSS -->
    <link rel="stylesheet" href="../../css/shared/components.css">
    
    <!-- Student CSS -->
    <link rel="stylesheet" href="../../css/student/student-global.css">
    
    <!-- Emotion Camera CSS (correct path) -->
    <link rel="stylesheet" href="../../components/emotion-camera/camera.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Learning Hub Specific Styles */
        .learning-hub {
            padding: var(--space-6);
        }
        
        .hub-header {
            margin-bottom: var(--space-8);
        }
        
        .hub-title {
            color: var(--primary-color);
            margin-bottom: var(--space-2);
        }
        
        .hub-subtitle {
            color: var(--text-secondary);
            max-width: 600px;
        }
        
        .learning-filters {
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .filter-label {
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }
        
        .learning-module {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--light-3);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .learning-module:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }
        
        .module-header {
            padding: var(--space-6);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            position: relative;
        }
        
        .module-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: var(--space-4);
        }
        
        .module-title {
            font-size: var(--text-xl);
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: white;
        }
        
        .module-meta {
            display: flex;
            gap: var(--space-4);
            font-size: var(--text-sm);
            opacity: 0.9;
        }
        
        .module-body {
            padding: var(--space-6);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .module-description {
            color: var(--text-secondary);
            margin-bottom: var(--space-4);
            line-height: 1.6;
        }
        
        .module-progress {
            margin-bottom: var(--space-4);
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2);
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--light-3);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            border-radius: var(--radius-full);
            transition: width 1s ease;
        }
        
        .module-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }
        
        .module-tag {
            background: var(--light-1);
            color: var(--text-secondary);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            font-weight: 500;
        }
        
        .module-footer {
            padding: var(--space-6);
            border-top: 1px solid var(--light-3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .module-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-sm);
            font-weight: 500;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-completed { background: var(--success-color); }
        .status-in-progress { background: var(--primary-color); }
        .status-not-started { background: var(--light-3); }
        
        /* Learning Tools Sidebar */
        .learning-tools {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: right 0.3s ease;
            padding: var(--space-6);
            overflow-y: auto;
        }
        
        .learning-tools.active {
            right: 0;
        }
        
        .tools-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--light-3);
        }
        
        .tools-title {
            font-size: var(--text-lg);
            font-weight: 600;
            color: var(--dark-1);
        }
        
        .tools-section {
            margin-bottom: var(--space-6);
        }
        
        .section-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .tool-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: var(--space-2);
        }
        
        .tool-item:hover {
            background: var(--light-1);
        }
        
        .tool-icon {
            font-size: 1.25rem;
            color: var(--primary-color);
        }
        
        .tool-name {
            flex: 1;
            font-weight: 500;
        }
        
        /* Focus Assistant */
        .focus-assistant {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.1), rgba(67, 97, 238, 0.1));
            border-radius: var(--radius);
            padding: var(--space-6);
            margin-top: var(--space-6);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }
        
        .assistant-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .assistant-icon {
            font-size: 2rem;
            color: var(--primary-light);
        }
        
        .assistant-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }
        
        .assistant-tip {
            background: white;
            border-radius: var(--radius);
            padding: var(--space-4);
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }
        
        .tip-icon {
            color: var(--primary-color);
            font-size: 1.25rem;
        }
        
        /* Empty State */
        .empty-modules {
            text-align: center;
            padding: var(--space-16) var(--space-6);
            grid-column: 1 / -1;
        }
        
        .empty-icon {
            font-size: 4rem;
            color: var(--light-3);
            margin-bottom: var(--space-4);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .modules-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .learning-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
        }
        
        /* Module Categories */
        .category-filter {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-bottom: var(--space-4);
        }
        
        .category-btn {
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            background: var(--light-1);
            border: 2px solid transparent;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .category-btn:hover,
        .category-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        /* Emotion Camera Container Styles */
            .emotion-camera-container {
                position: fixed;
                bottom: 80px;
                right: 20px;
                width: 320px;
                z-index: 999;
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                overflow: hidden;
                border: 1px solid var(--light-3);
                transition: all 0.3s ease;
            }
            
            .emotion-camera-container.collapsed {
                width: 60px;
                height: 60px;
            }
            
            .emotion-camera-container.collapsed [data-component="emotion-camera"] {
                display: none;
            }
            
            .camera-toggle-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 1000;
                font-size: 18px;
            }
            
            /* Make room for the camera when it's expanded */
            .learning-hub {
                padding-right: 360px; /* Make space for the camera */
                transition: padding-right 0.3s ease;
            }
            
            .emotion-camera-container.collapsed + .learning-hub {
                padding-right: 100px;
            }
            
            /* Responsive adjustments */
            @media (max-width: 1200px) {
                .emotion-camera-container {
                    position: relative;
                    width: 100%;
                    max-width: 400px;
                    margin: 0 auto 20px;
                    right: auto;
                    bottom: auto;
                }
                
                .learning-hub {
                    padding-right: var(--space-6);
                }
            }
        </style
    </head>
<body class="student-theme">
    <!-- Header will be inserted by StudentGlobal -->
    
    <!-- Emotion Camera Container (Fixed Position) -->
    <div class="emotion-camera-container" id="emotion-camera-wrapper">
        <button class="camera-toggle-btn" id="toggle-camera" title="Toggle Emotion Camera">
            <i class="fas fa-camera"></i>
        </button>
        <div data-component="emotion-camera"></div>
    </div>

    <!-- Add to learning.html after emotion-camera-container -->
    <div class="webcam-preview-container" id="webcam-preview" style="display: none;">
        <div class="webcam-preview-header">
            <div class="webcam-preview-title">Webcam Preview</div>
            <div class="webcam-preview-controls">
                <button class="webcam-control-btn" id="hide-webcam" title="Hide Preview">
                    <i class="fas fa-eye-slash"></i>
                </button>
                <button class="webcam-control-btn" id="capture-frame" title="Capture Frame">
                    <i class="fas fa-camera"></i>
                </button>
                <button class="webcam-control-btn" id="webcam-settings" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        <video class="webcam-preview-video" id="webcam-preview-video" autoplay muted playsinline></video>
        <div class="webcam-preview-info" id="webcam-info">
            Emotion detection active
        </div>
    </div>

    <div class="privacy-indicator" id="privacy-indicator" style="display: none;">
        <i class="fas fa-shield-alt"></i>
        <span>Webcam active - Processing locally</span>
    </div>
    
    <!-- Agent Feedback Panel -->
    <div class="agent-feedback-panel" id="agent-feedback">
        <div class="feedback-header">
            <div class="agent-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div>
                <div class="agent-name">Learning Assistant</div>
                <div class="agent-status" id="agent-status">Analyzing your learning patterns...</div>
            </div>
        </div>
        <div class="feedback-message" id="agent-message">
            Hi! I'm here to help you learn better. Based on your current focus, I'll suggest the best learning activities.
        </div>
        <div class="feedback-suggestions" id="agent-suggestions">
            <div class="suggestion-item" data-suggestion="focus-session">
                <i class="fas fa-bullseye"></i>
                <span>Start a 25-minute focus session</span>
            </div>
            <div class="suggestion-item" data-suggestion="break-time">
                <i class="fas fa-coffee"></i>
                <span>Take a 5-minute break</span>
            </div>
        </div>
    </div>
    
    <!-- Emotion Status Indicator -->
    <div class="emotion-status-indicator" id="emotion-status">
        <div class="current-emotion-icon" id="current-emotion-icon">üòä</div>
        <div class="emotion-status-text">
            <strong>Current State:</strong>
            <span id="current-emotion-text">Focused & Engaged</span>
        </div>
    </div>
    
    <!-- Quick Focus Tools -->
    <div class="quick-focus-tools" id="quick-tools">
        <button class="quick-tool-btn" id="focus-timer-btn" title="Start Focus Timer">
            <i class="fas fa-hourglass-half"></i>
        </button>
        <button class="quick-tool-btn" id="distraction-btn" title="Block Distractions">
            <i class="fas fa-ban"></i>
        </button>
        <button class="quick-tool-btn" id="music-btn" title="Focus Music">
            <i class="fas fa-music"></i>
        </button>
        <button class="quick-tool-btn" id="break-btn" title="Take a Break">
            <i class="fas fa-couch"></i>
        </button>
    </div>
    
    <!-- Focus Mode Overlay -->
    <div class="focus-mode-overlay" id="focus-mode">
        <div class="focus-mode-content">
            <h2>Focus Session Started</h2>
            <p>Stay focused on your current task. All distractions are minimized.</p>
            <div class="focus-timer" id="focus-timer">25:00</div>
            <div class="focus-stats">
                <div class="progress-stat">
                    <div class="stat-value" id="focus-score">85%</div>
                    <div class="stat-label">Current Focus</div>
                </div>
            </div>
            <div class="focus-actions">
                <button class="btn btn-secondary" id="pause-focus">Pause</button>
                <button class="btn btn-danger" id="end-focus">End Session</button>
            </div>
        </div>
    </div>
    
    <main class="student-main">
        <div class="learning-hub">
            <!-- Progress Dashboard -->
            <div class="progress-dashboard slide-in">
                <div class="progress-stats">
                    <div class="progress-stat">
                        <div class="stat-value" id="total-modules">12</div>
                        <div class="stat-label">Total Modules</div>
                    </div>
                    <div class="progress-stat">
                        <div class="stat-value" id="completed-modules">8</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="progress-stat">
                        <div class="stat-value" id="current-streak">5</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="progress-stat">
                        <div class="stat-value" id="avg-score">92%</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                </div>
            </div>
            
            <div class="hub-header">
                <h1 class="hub-title">Learning Hub</h1>
                <p class="hub-subtitle">Explore learning modules designed for your needs. Your empathetic companion is here to help you succeed.</p>
            </div>
            
            <!-- Learning Filters -->
            <div class="learning-filters">
                <div class="filter-group">
                    <span class="filter-label">Filter by:</span>
                    <select class="select-control" id="subject-filter">
                        <option value="all">All Subjects</option>
                        <option value="math">Mathematics</option>
                        <option value="reading">Reading & Writing</option>
                        <option value="science">Science</option>
                        <option value="social">Social Studies</option>
                        <option value="coding">Coding</option>
                        <option value="art">Arts & Creativity</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <select class="select-control" id="difficulty-filter">
                        <option value="all">All Difficulties</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="master">Master Level</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <select class="select-control" id="status-filter">
                        <option value="all">All Status</option>
                        <option value="not-started">Not Started</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="recommended">Recommended</option>
                    </select>
                </div>
                
                <div class="filter-group" style="margin-left: auto;">
                    <input type="text" class="form-control" id="search-modules" placeholder="Search modules..." style="min-width: 200px;">
                </div>
            </div>
            
            <!-- Category Filter -->
            <div class="category-filter">
                <button class="category-btn active" data-category="all">All Modules</button>
                <button class="category-btn" data-category="recommended">Recommended for You</button>
                <button class="category-btn" data-category="popular">Most Popular</button>
                <button class="category-btn" data-category="new">New Arrivals</button>
                <button class="category-btn" data-category="challenging">Challenging Tasks</button>
                <button class="category-btn" data-category="quick">Quick Sessions</button>
            </div>
            
            <!-- Modules Grid -->
            <div class="modules-grid" id="modules-container">
                <!-- Modules will be loaded dynamically -->
                <div class="empty-modules" id="empty-state" style="display: none;">
                    <div class="empty-icon">üìö</div>
                    <h3>No modules found</h3>
                    <p>Try adjusting your filters or check back later for new content.</p>
                </div>
            </div>
            
            <!-- Focus Assistant -->
            <div class="focus-assistant">
                <div class="assistant-header">
                    <div class="assistant-icon">üéØ</div>
                    <div>
                        <h3>Focus Assistant</h3>
                        <p>Tools to help you stay focused and motivated</p>
                    </div>
                </div>
                <div class="assistant-content">
                    <div class="assistant-tip" data-tool="pomodoro">
                        <div class="tip-icon">‚è∞</div>
                        <div>
                            <strong>Pomodoro Timer</strong>
                            <p>Work for 25 minutes, break for 5</p>
                        </div>
                    </div>
                    <div class="assistant-tip" data-tool="breathing">
                        <div class="tip-icon">üå¨Ô∏è</div>
                        <div>
                            <strong>Breathing Exercise</strong>
                            <p>Calm your mind in 60 seconds</p>
                        </div>
                    </div>
                    <div class="assistant-tip" data-tool="challenge">
                        <div class="tip-icon">üéØ</div>
                        <div>
                            <strong>Focus Challenge</strong>
                            <p>Test your attention span</p>
                        </div>
                    </div>
                    <div class="assistant-tip" data-tool="progress">
                        <div class="tip-icon">üìä</div>
                        <div>
                            <strong>Progress Tracker</strong>
                            <p>See how much you've accomplished</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Learning Tips Section -->
            <div class="learning-tips">
                <h3 class="tips-title"><i class="fas fa-lightbulb"></i> Personalized Learning Tips</h3>
                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon"><i class="fas fa-brain"></i></div>
                        <h4>Active Recall</h4>
                        <p>Test yourself frequently instead of just re-reading material.</p>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon"><i class="fas fa-exchange-alt"></i></div>
                        <h4>Interleaving</h4>
                        <p>Switch between different topics during study sessions.</p>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon"><i class="fas fa-bed"></i></div>
                        <h4>Sleep Matters</h4>
                        <p>Get 7-9 hours of sleep for optimal memory consolidation.</p>
                    </div>
                    <div class="tip-card">
                        <div class="tip-icon"><i class="fas fa-utensils"></i></div>
                        <h4>Brain Food</h4>
                        <p>Stay hydrated and eat omega-3 rich foods for better focus.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Learning Tools Sidebar -->
    <div class="learning-tools" id="learning-tools">
        <div class="tools-header">
            <h3 class="tools-title">Learning Tools</h3>
            <button class="btn-icon" id="close-tools">√ó</button>
        </div>
        
        <div class="tools-section">
            <div class="section-title">Focus Tools</div>
            <div class="tool-item" data-tool="timer">
                <span class="tool-icon"><i class="fas fa-hourglass-half"></i></span>
                <span class="tool-name">Focus Timer</span>
            </div>
            <div class="tool-item" data-tool="distraction-blocker">
                <span class="tool-icon"><i class="fas fa-ban"></i></span>
                <span class="tool-name">Distraction Blocker</span>
            </div>
            <div class="tool-item" data-tool="ambient-sounds">
                <span class="tool-icon"><i class="fas fa-music"></i></span>
                <span class="tool-name">Ambient Sounds</span>
            </div>
            <div class="tool-item" data-tool="focus-music">
                <span class="tool-icon"><i class="fas fa-headphones"></i></span>
                <span class="tool-name">Focus Music</span>
            </div>
        </div>
        
        <div class="tools-section">
            <div class="section-title">Learning Aids</div>
            <div class="tool-item" data-tool="dictionary">
                <span class="tool-icon"><i class="fas fa-book"></i></span>
                <span class="tool-name">Dictionary</span>
            </div>
            <div class="tool-item" data-tool="calculator">
                <span class="tool-icon"><i class="fas fa-calculator"></i></span>
                <span class="tool-name">Calculator</span>
            </div>
            <div class="tool-item" data-tool="note-taker">
                <span class="tool-icon"><i class="fas fa-sticky-note"></i></span>
                <span class="tool-name">Note Taker</span>
            </div>
            <div class="tool-item" data-tool="text-to-speech">
                <span class="tool-icon"><i class="fas fa-volume-up"></i></span>
                                <span class="tool-name">Text-to-Speech</span>
            </div>
            <div class="tool-item" data-tool="mind-map">
                <span class="tool-icon"><i class="fas fa-project-diagram"></i></span>
                <span class="tool-name">Mind Map</span>
            </div>
        </div>
        
        <div class="tools-section">
            <div class="section-title">Accessibility</div>
            <div class="tool-item" data-tool="high-contrast">
                <span class="tool-icon"><i class="fas fa-adjust"></i></span>
                <span class="tool-name">High Contrast</span>
            </div>
            <div class="tool-item" data-tool="text-size">
                <span class="tool-icon"><i class="fas fa-text-height"></i></span>
                <span class="tool-name">Text Size</span>
            </div>
            <div class="tool-item" data-tool="read-aloud">
                <span class="tool-icon"><i class="fas fa-assistive-listening-systems"></i></span>
                <span class="tool-name">Read Aloud</span>
            </div>
            <div class="tool-item" data-tool="dyslexia-font">
                <span class="tool-icon"><i class="fas fa-font"></i></span>
                <span class="tool-name">Dyslexia Font</span>
            </div>
        </div>
        
        <div class="tools-section">
            <div class="section-title">Productivity</div>
            <div class="tool-item" data-tool="goals">
                <span class="tool-icon"><i class="fas fa-flag"></i></span>
                <span class="tool-name">Daily Goals</span>
            </div>
            <div class="tool-item" data-tool="stats">
                <span class="tool-icon"><i class="fas fa-chart-line"></i></span>
                <span class="tool-name">Learning Stats</span>
            </div>
            <div class="tool-item" data-tool="achievements">
                <span class="tool-icon"><i class="fas fa-trophy"></i></span>
                <span class="tool-name">Achievements</span>
            </div>
        </div>
    </div>
    
    <!-- Tools Toggle Button -->
    <button class="btn btn-primary" id="toggle-tools" style="position: fixed; bottom: 20px; right: 20px; z-index: 999; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <i class="fas fa-tools"></i> Learning Tools
    </button>    

    <!-- Load Human.js FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/human/dist/human.js"></script>
    
    <!-- Global and Core modules -->
    <script src="../../js/global.js"></script>
    <script src="../../js/config.js"></script>
    <script src="../../js/modules/auth.js"></script>
    <script src="../../js/modules/storage.js"></script>
    <script src="../../js/modules/api.js"></script>
    <script src="../../js/modules/utils.js"></script>
    
    <!-- AI Modules - SIMPLIFIED ORDER -->
    <script src="../../js/ai/focus-monitor.js"></script>
    <script src="../../js/ai/engagement-tracker.js"></script>
    <script src="../../js/ai/intervention-planner.js"></script>
    <script src="../../js/ai/privacy-manager.js"></script>
    
    <!-- Emotion modules - LOAD THEM PROPERLY -->
    <script src="../../js/ai/emotion-detector.js"></script>
    <script src="../../js/ai/emotion-fusion.js"></script>
    <script src="../../js/ai/webcam-emotion.js"></script>
    <script src="../../js/ai/emotion-integration.js"></script>
    
    <!-- Component -->
    <script src="../../components/emotion-camera/camera.js"></script>
    
    <!-- Student -->
    <script src="../../js/student/student-global.js"></script>
    
    <!-- Learning page specific -->
    <script src="../../js/student/learning.js"></script>
    
    <!-- SIMPLE INITIALIZATION SCRIPT -->
    <script>
        // Simple dependency check
        function checkDependencies() {
            console.log('=== DEPENDENCY CHECK ===');
            console.log('Human:', typeof window.Human);
            console.log('EmotionDetector:', typeof window.EmotionDetector);
            console.log('EmotionFusion:', typeof window.EmotionFusion);
            console.log('WebcamEmotionDetector:', typeof window.WebcamEmotionDetector);
            console.log('EmotionSystemIntegrator:', typeof window.EmotionSystemIntegrator);
            console.log('========================');
        }
        
        // Enhanced initialization with webcam preview
        async function initEmotionSystem() {
            console.log('Initializing emotion system with webcam preview...');
            
            try {
                // Check if EmotionSystemIntegrator is defined
                if (typeof window.EmotionSystemIntegrator === 'undefined') {
                    throw new Error('EmotionSystemIntegrator not found');
                }
                
                // Create instance
                window.emotionSystem = new EmotionSystemIntegrator();
                console.log('EmotionSystem instance created');
                
                // Initialize
                await window.emotionSystem.init();
                console.log('EmotionSystem initialized');
                
                // Setup webcam preview
                setupWebcamPreview();
                
                // Start system
                if (window.emotionSystem.startSystem) {
                    window.emotionSystem.startSystem();
                    console.log('EmotionSystem started');
                }
                
                return true;
                
            } catch (error) {
                console.error('Failed to initialize emotion system:', error);
                return false;
            }
        }
        
        function setupWebcamPreview() {
            const previewContainer = document.getElementById('webcam-preview');
            const previewVideo = document.getElementById('webcam-preview-video');
            const privacyIndicator = document.getElementById('privacy-indicator');
            const hideWebcamBtn = document.getElementById('hide-webcam');
            const captureFrameBtn = document.getElementById('capture-frame');
            
            // Load preference
            const showPreview = Storage.get('webcam_preview_enabled', true);
            
            // Show/hide preview based on preference
            if (showPreview && previewContainer) {
                previewContainer.style.display = 'flex';
                privacyIndicator.style.display = 'flex';
            }
            
            // Hide preview button
            if (hideWebcamBtn) {
                hideWebcamBtn.addEventListener('click', () => {
                    previewContainer.style.display = 'none';
                    privacyIndicator.style.display = 'none';
                    Storage.set('webcam_preview_enabled', false);
                });
            }
            
            // Capture frame button (for debugging/screenshots)
            if (captureFrameBtn) {
                captureFrameBtn.addEventListener('click', () => {
                    if (previewVideo && previewVideo.srcObject) {
                        const canvas = document.createElement('canvas');
                        canvas.width = previewVideo.videoWidth;
                        canvas.height = previewVideo.videoHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(previewVideo, 0, 0);
                        
                        // Create download link
                        const link = document.createElement('a');
                        link.download = 'emotion-preview.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    }
                });
            }
            
            // Settings button
            const settingsBtn = document.getElementById('webcam-settings');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    showWebcamSettings();
                });
            }
        }
        
        function showWebcamSettings() {
            const modalContent = `
                <div class="webcam-settings">
                    <h3>Webcam Settings</h3>
                    <div class="setting-option">
                        <label>
                            <input type="checkbox" id="show-preview" checked>
                            Show webcam preview
                        </label>
                        <p class="setting-description">Display your webcam feed with emotion overlay</p>
                    </div>
                    <div class="setting-option">
                        <label>
                            <input type="checkbox" id="draw-face" checked>
                            Draw face detection boxes
                        </label>
                        <p class="setting-description">Show boxes around detected faces</p>
                    </div>
                    <div class="setting-option">
                        <label>
                            <input type="checkbox" id="draw-emotion" checked>
                            Show emotion labels
                        </label>
                        <p class="setting-description">Display detected emotions on screen</p>
                    </div>
                    <div class="setting-option">
                        <label>
                            <input type="checkbox" id="always-monitor" checked>
                            Always monitor focus
                        </label>
                        <p class="setting-description">Continue monitoring even when preview is hidden</p>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn-primary" id="save-settings">Save Settings</button>
                        <button class="btn btn-secondary" id="reset-settings">Reset to Defaults</button>
                    </div>
                </div>
            `;
            
            // Show modal (you'll need to implement showModal function)
            if (window.StudentApp?.showModal) {
                window.StudentApp.showModal({
                    title: 'Webcam Settings',
                    content: modalContent,
                    showClose: true
                });
                
                // Load current settings
                setTimeout(() => {
                    document.getElementById('show-preview').checked = 
                        Storage.get('webcam_preview_enabled', true);
                    document.getElementById('draw-face').checked = 
                        Storage.get('webcam_draw_face', true);
                    document.getElementById('draw-emotion').checked = 
                        Storage.get('webcam_draw_emotion', true);
                    document.getElementById('always-monitor').checked = 
                        Storage.get('always_monitor_focus', true);
                    
                    // Save settings
                    document.getElementById('save-settings').addEventListener('click', () => {
                        const settings = {
                            webcam_preview_enabled: document.getElementById('show-preview').checked,
                            webcam_draw_face: document.getElementById('draw-face').checked,
                            webcam_draw_emotion: document.getElementById('draw-emotion').checked,
                            always_monitor_focus: document.getElementById('always-monitor').checked
                        };
                        
                        Object.entries(settings).forEach(([key, value]) => {
                            Storage.set(key, value);
                        });
                        
                        // Update webcam detector config
                        if (window.emotionSystem?.modules?.webcam) {
                            window.emotionSystem.modules.webcam.config.drawFace = 
                                settings.webcam_draw_face;
                            window.emotionSystem.modules.webcam.config.drawEmotion = 
                                settings.webcam_draw_emotion;
                        }
                        
                        // Update focus monitor settings
                        if (window.FocusMonitor) {
                            window.FocusMonitor.settings.monitorEvenWhenHidden = 
                                settings.always_monitor_focus;
                            Storage.set('focus_monitor_settings', window.FocusMonitor.settings);
                        }
                        
                        // Close modal
                        document.querySelector('.student-modal').remove();
                    });
                    
                    // Reset settings
                    document.getElementById('reset-settings').addEventListener('click', () => {
                        document.getElementById('show-preview').checked = true;
                        document.getElementById('draw-face').checked = true;
                        document.getElementById('draw-emotion').checked = true;
                        document.getElementById('always-monitor').checked = true;
                    });
                }, 100);
            }
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            if (!Auth.isLoggedIn() || !Auth.isStudent()) {
                window.location.href = '../shared/login.html';
                return;
            }
            
            // Initialize tools sidebar
            const toggleToolsBtn = document.getElementById('toggle-tools');
            const toolsSidebar = document.getElementById('learning-tools');
            const closeToolsBtn = document.getElementById('close-tools');
            
            if (toggleToolsBtn && toolsSidebar) {
                toggleToolsBtn.addEventListener('click', () => {
                    toolsSidebar.classList.toggle('active');
                });
            }
            
            if (closeToolsBtn && toolsSidebar) {
                closeToolsBtn.addEventListener('click', () => {
                    toolsSidebar.classList.remove('active');
                });
            }

            // Show privacy consent if needed
            const privacyAccepted = await PrivacyManager.showWebcamConsent();
            
            if (privacyAccepted) {
                // Start emotion system
                setTimeout(async () => {
                    await initEmotionSystem();
                }, 1000);
            } else {
                console.log('Webcam features declined, using basic monitoring');
                // Initialize focus monitor only
                window.FocusMonitor = new FocusMonitor();
            }
        });
    </script
</body>
</html>